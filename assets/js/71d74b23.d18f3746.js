"use strict";(self.webpackChunkflamingock=self.webpackChunkflamingock||[]).push([[2127],{7545:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"changes/apply-and-rollback-methods","title":"Apply and rollback methods","description":"Quick start","source":"@site/docs/changes/apply-and-rollback-methods.md","sourceDirName":"changes","slug":"/changes/apply-and-rollback-methods","permalink":"/docs/changes/apply-and-rollback-methods","draft":false,"unlisted":false,"editUrl":"https://github.com/flamingock/flamingock-java/docs/changes/apply-and-rollback-methods.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Apply and rollback methods","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Anatomy & Structure","permalink":"/docs/changes/anatomy-and-structure"},"next":{"title":"Transactions","permalink":"/docs/changes/transactions"}}');var s=a(4848),r=a(8453);const l={title:"Apply and rollback methods",sidebar_position:3},c="Apply and rollback methods",t={},o=[{value:"Quick start",id:"quick-start",level:2},{value:"Basic examples",id:"basic-examples",level:3},{value:"Where parameters come from",id:"where-parameters-come-from",level:2},{value:"Method rules",id:"method-rules",level:2},{value:"Advanced topics",id:"advanced-topics",level:2},{value:"Type-based injection",id:"type-based-injection",level:3},{value:"Named parameters",id:"named-parameters",level:3},{value:"Optional parameters",id:"optional-parameters",level:3},{value:"Lock-guarded dependencies",id:"lock-guarded-dependencies",level:3},{value:"Dependency resolution details",id:"dependency-resolution-details",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"apply-and-rollback-methods",children:"Apply and rollback methods"})}),"\n",(0,s.jsx)(n.h2,{id:"quick-start",children:"Quick start"}),"\n",(0,s.jsx)(n.p,{children:"Your Change methods receive the dependencies they need as parameters - Flamingock automatically provides them."}),"\n",(0,s.jsx)(n.h3,{id:"basic-examples",children:"Basic examples"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Apply\npublic void configureBucket(S3Client s3Client, AdminClient adminClient, FeatureFlagService flags) {\n\n}\n\n@Rollback\npublic void configureBucket(S3Client s3Client, AdminClient adminClient, FeatureFlagService flags) {\n\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Why rollback is required:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Executed automatically on failure for non-transactional systems"}),"\n",(0,s.jsx)(n.li,{children:"Required for  undo operations"}),"\n",(0,s.jsx)(n.li,{children:"Ensures every change can be reversed"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"where-parameters-come-from",children:"Where parameters come from"}),"\n",(0,s.jsx)(n.p,{children:"Flamingock resolves method parameters from three sources (in priority order):"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Target system context"})," - System-specific dependencies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Global context"})," - Shared application dependencies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Framework context"})," - e.g., Spring beans"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The exact dependencies available depend on your target system and configuration."}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"/docs/flamingock-library-config/context-and-dependencies",children:"Context and Dependencies"})," for complete details on configuring and understanding available dependencies."]}),"\n",(0,s.jsx)(n.h2,{id:"method-rules",children:"Method rules"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Must be public"})," - Flamingock needs to invoke them"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Any name works"})," - ",(0,s.jsx)(n.code,{children:"apply"}),", ",(0,s.jsx)(n.code,{children:"execute"}),", ",(0,s.jsx)(n.code,{children:"migrate"}),", your choice"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Return type ignored"})," - Can be void or return a value"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"All parameters injected"})," - No manual parameters"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"advanced-topics",children:"Advanced topics"}),"\n",(0,s.jsx)(n.h3,{id:"type-based-injection",children:"Type-based injection"}),"\n",(0,s.jsx)(n.p,{children:"Parameters are injected based on their type:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Apply\npublic void apply(KafkaTemplate kafka, ConfigService config) {\n    // Flamingock looks for matching types in the context\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"named-parameters",children:"Named parameters"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"@Named"})," when multiple beans of the same type exist:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Apply\npublic void apply(\n    @Named("orders") KafkaTemplate ordersKafka,\n    @Named("notifications") KafkaTemplate notificationsKafka\n) {\n    // Specific instances by name\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"optional-parameters",children:"Optional parameters"}),"\n",(0,s.jsx)(n.p,{children:"By default, all parameters are required. Missing dependencies throw exceptions."}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"@Nullable"})," for optional dependencies:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Apply\npublic void apply(\n    S3Client s3,                      // Required\n    @Nullable CacheService cache      // Optional - null if not available\n) {\n    if (cache != null) {\n        cache.invalidate();\n    }\n    // proceed with S3 operation\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"lock-guarded-dependencies",children:"Lock-guarded dependencies"}),"\n",(0,s.jsx)(n.p,{children:"Flamingock uses a background daemon to automatically refresh the distributed lock, ensuring your Changes maintain exclusive access during execution. As an additional safety layer, Flamingock wraps injected dependencies with proxies that verify the lock is still valid before each method call."}),"\n",(0,s.jsx)(n.p,{children:"This proxy mechanism provides extra robustness - ensuring that operations don't even start if the lock is lost for any reason (though this is very unlikely given the background refresh daemon)."}),"\n",(0,s.jsxs)(n.p,{children:["For non-critical or local components, use ",(0,s.jsx)(n.code,{children:"@NonLockGuarded"})," to skip the proxy:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Apply\npublic void apply(\n    ElasticsearchClient elastic,               // Lock-guarded (default)\n    @NonLockGuarded List<String> localData     // Not guarded - no proxy overhead\n) {\n    // elastic calls are protected by lock validation\n    // localData is used directly without checks\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"/docs/flamingock-library-config/lock",children:"Lock documentation"})," for more details on lock protection."]}),"\n",(0,s.jsx)(n.h3,{id:"dependency-resolution-details",children:"Dependency resolution details"}),"\n",(0,s.jsx)(n.p,{children:"When Flamingock looks for a dependency to inject, it follows a specific hierarchy. This ensures system-specific dependencies take precedence over general ones."}),"\n",(0,s.jsxs)(n.p,{children:["For complete understanding of dependency resolution, see ",(0,s.jsx)(n.a,{href:"/docs/flamingock-library-config/context-and-dependencies#dependency-resolution-hierarchy",children:"Dependency Resolution Hierarchy"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>l,x:()=>c});var i=a(6540);const s={},r=i.createContext(s);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);