"use strict";(self.webpackChunkflamingock=self.webpackChunkflamingock||[]).push([[2987],{415:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"testing/integration-testing","title":"Integration Testing","description":"Introduction","source":"@site/docs/testing/integration-testing.md","sourceDirName":"testing","slug":"/testing/integration-testing","permalink":"/testing/integration-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/flamingock/flamingock-java/docs/testing/integration-testing.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Integration Testing","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Unit Testing","permalink":"/testing/unit-testing"},"next":{"title":"Spring Boot  Testing","permalink":"/testing/springboot-integration-testing"}}');var i=n(4848),a=n(8453);const r={title:"Integration Testing",sidebar_position:3},o=void 0,c={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Example: Creating an S3 bucket",id:"example-creating-an-s3-bucket",level:2},{value:"Integration test with Testcontainers",id:"integration-test-with-testcontainers",level:2},{value:"\u2705 Best practices",id:"-best-practices",level:2}];function d(e){const t={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(t.p,{children:["Integration tests ensure that Flamingock operates correctly in a real environment by executing Changes against live systems. Flamingock uses a ",(0,i.jsx)(t.strong,{children:"dual-system"})," that separates:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Target systems"}),": Where business changes are applied (databases, APIs, cloud services)"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Audit stores"}),": Where execution tracking and metadata are persisted (separate from target systems)"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Integration tests should validate the complete pipeline:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Change execution against target systems"}),"\n",(0,i.jsx)(t.li,{children:"Audit log persistence in audit stores"}),"\n",(0,i.jsx)(t.li,{children:"Distributed lock acquisition"}),"\n",(0,i.jsx)(t.li,{children:"Recovery and rollback capabilities"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"example-creating-an-s3-bucket",children:"Example: Creating an S3 bucket"}),"\n",(0,i.jsx)(t.p,{children:"Suppose you have a Change that creates an Amazon S3 bucket (target system) while using MongoDB as the audit store:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:'@TargetSystem(id = "aws-s3")\n@Change(id = "create-bucket", author = "dev-team")\npublic class _0001__CreateS3Bucket {\n\n  @Apply\n  public void apply(S3Client s3Client) {\n    s3Client.createBucket(CreateBucketRequest.builder()\n        .bucket("flamingock-test-bucket")\n        .build());\n  }\n\n  @Rollback\n  public void rollback(S3Client s3Client) {\n    s3Client.deleteBucket(DeleteBucketRequest.builder()\n        .bucket("flamingock-test-bucket")\n        .build());\n  }\n}\n'})}),"\n",(0,i.jsx)(t.h2,{id:"integration-test-with-testcontainers",children:"Integration test with Testcontainers"}),"\n",(0,i.jsx)(t.p,{children:"To test this change end-to-end, we will:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Spin up a MongoDB container to be used as Flamingock\u2019s audit backend"}),"\n",(0,i.jsxs)(t.li,{children:["Using ",(0,i.jsx)(t.strong,{children:"S3 as the target system"})," (where business changes are applied)"]}),"\n",(0,i.jsxs)(t.li,{children:["Using ",(0,i.jsx)(t.strong,{children:"MongoDB as the audit store"})," (where execution metadata is tracked)"]}),"\n",(0,i.jsx)(t.li,{children:"Configure Flamingock and execute it"}),"\n",(0,i.jsx)(t.li,{children:"Validating both systems independently"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:'@Testcontainers\nclass FlamingockIntegrationTest {\n\n    @Container\n    static final MongoDBContainer mongoContainer = new MongoDBContainer("mongo:6.0");\n\n    @Container\n    static final LocalStackContainer localstack = new LocalStackContainer(DockerImageName.parse("localstack/localstack:latest"))\n            .withServices(LocalStackContainer.Service.S3);\n\n    @Test\n    void shouldExecuteChangeAgainstTargetSystemAndAuditToStore() {\n        // Configure S3 client (target system)\n        S3Client s3Client = S3Client.builder()\n                .endpointOverride(localstack.getEndpointOverride(LocalStackContainer.Service.S3))\n                .credentialsProvider(StaticCredentialsProvider.create(\n                    AwsBasicCredentials.create(localstack.getAccessKey(), localstack.getSecretKey())))\n                .region(Region.US_EAST_1)\n                .build();\n\n        // Configure MongoDB client\n        MongoClient mongoClient = MongoClients.create(mongoContainer.getReplicaSetUrl());\n\n        // Configure target systems\n        var s3TargetSystem = new NonTransactionalTargetSystem("aws-s3")\n                .addDependency(s3Client);\n\n        // Configure Flamingock with target system and audit store\n        Runner runner = Flamingock.builder()\n                .setAuditStore(new MongoDBSyncAuditStore(mongoClient, \'flamingock-test-db\'))\n                .addTargetSystem(s3TargetSystem)\n                .build();\n\n        // Execute Flamingock\n        runner.execute();\n\n        // \u2705 Verify the target system (S3) received the change\n        ListBucketsResponse buckets = s3Client.listBuckets();\n        boolean bucketExists = buckets.buckets().stream()\n                .anyMatch(b -> b.name().equals("flamingock-test-bucket"));\n        assertTrue(bucketExists, "Expected S3 bucket was not created in target system");\n\n        // \u2705 Verify the audit store (MongoDB) tracked the execution\n        MongoCollection<Document> auditCollection = auditDatabase.getCollection("flamingockAuditLog");\n\n        Document auditEntry = auditCollection.find(\n            new Document("changeId", "create-bucket")\n                .append("state", "EXECUTED")\n        ).first();\n        \n        assertNotNull(auditEntry, "Change execution was not tracked in audit store");\n        assertEquals("create-bucket", auditEntry.getString("changeId"));\n        assertEquals("EXECUTED", auditEntry.getString("state"));\n    }\n}\n'})}),"\n",(0,i.jsx)(t.h2,{id:"-best-practices",children:"\u2705 Best practices"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Use @TargetSystem annotation"}),": Always annotate Changes with their target system identifier"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Separate concerns"}),": Test target system changes and audit store persistence independently"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Use real containers"}),": Testcontainers provides realistic test environments for both target systems and audit stores"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Test failure scenarios"}),": Verify that audit integrity is maintained even when target systems fail"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Validate dual-architecture"}),": Ensure changes reach target systems and tracking reaches audit stores"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Clean up properly"}),": Reset both target systems and audit stores between tests"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Use appropriate audit stores"}),": Choose audit stores based on your operational requirements, not target system constraints"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Test recovery"}),": Verify that Flamingock can recover and continue from audit store state when target systems are restored"]}),"\n"]})]})}function g(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var s=n(6540);const i={},a=s.createContext(i);function r(e){const t=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);