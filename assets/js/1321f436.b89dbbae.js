"use strict";(self.webpackChunkflamingock=self.webpackChunkflamingock||[]).push([[305],{6776:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"target-systems/couchbase-target-system","title":"Couchbase","description":"The Couchbase target system (CouchbaseTargetSystem) enables Flamingock to apply changes to Couchbase databases using the official Couchbase Java SDK. As a transactional target system, it supports automatic rollback through Couchbase\'s transaction capabilities.","source":"@site/docs/target-systems/couchbase-target-system.md","sourceDirName":"target-systems","slug":"/target-systems/couchbase-target-system","permalink":"/docs/target-systems/couchbase-target-system","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/target-systems/couchbase-target-system.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Couchbase","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"DynamoDB","permalink":"/docs/target-systems/dynamodb-target-system"},"next":{"title":"Default (Non-transactional)","permalink":"/docs/target-systems/default-target-system"}}');var a=n(4848),c=n(8453);const i={title:"Couchbase",sidebar_position:5},r="Couchbase Target System",o={},l=[{value:"Minimum recommended setup",id:"minimum-recommended-setup",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Required dependencies",id:"required-dependencies",level:3},{value:"Configuration example",id:"configuration-example",level:2},{value:"Transactional support",id:"transactional-support",level:2},{value:"Available dependencies in ChangeUnits",id:"available-dependencies-in-changeunits",level:2},{value:"Next steps",id:"next-steps",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"couchbase-target-system",children:"Couchbase Target System"})}),"\n",(0,a.jsxs)(t.p,{children:["The Couchbase target system (",(0,a.jsx)(t.code,{children:"CouchbaseTargetSystem"}),") enables Flamingock to apply changes to Couchbase databases using the official Couchbase Java SDK. As a transactional target system, it supports automatic rollback through Couchbase's transaction capabilities."]}),"\n",(0,a.jsx)(t.h2,{id:"minimum-recommended-setup",children:"Minimum recommended setup"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",children:'CouchbaseTargetSystem couchbaseTarget = new CouchbaseTargetSystem("user-database")\n    .withCluster(cluster)\n    .withBucket(bucket);\n'})}),"\n",(0,a.jsx)(t.p,{children:"While dependencies can be provided through the global context, we highly recommend injecting them directly at the target system level. This provides clearer scoping, better isolation between systems, and makes dependencies explicit and easier to track."}),"\n",(0,a.jsx)(t.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,a.jsxs)(t.p,{children:["Following Flamingock's ",(0,a.jsx)(t.a,{href:"../flamingock-library-config/target-system-configuration.md#dependency-resolution-hierarchy",children:"dependency resolution hierarchy"}),", you can provide dependencies via direct injection or global context."]}),"\n",(0,a.jsx)(t.h3,{id:"required-dependencies",children:"Required dependencies"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Dependency"}),(0,a.jsx)(t.th,{children:"Method"}),(0,a.jsx)(t.th,{children:"Description"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"Cluster"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:".withCluster(cluster)"})}),(0,a.jsxs)(t.td,{children:["Couchbase cluster connection - ",(0,a.jsx)(t.strong,{children:"required"})," for both ChangeUnit execution and transaction management"]})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"Bucket"})}),(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:".withBucket(bucket)"})}),(0,a.jsxs)(t.td,{children:["Target bucket instance - ",(0,a.jsx)(t.strong,{children:"required"})," for both ChangeUnit execution and transaction management"]})]})]})]}),"\n",(0,a.jsxs)(t.p,{children:["Remember: If not provided directly via ",(0,a.jsx)(t.code,{children:".withXXX()"}),", Flamingock searches the global context. If still not found:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Required dependencies"})," will throw an exception"]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"configuration-example",children:"Configuration example"}),"\n",(0,a.jsx)(t.p,{children:"Here's a comprehensive example showing dependency resolution:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",children:'// Target system with specific dependencies\nCouchbaseTargetSystem couchbaseTarget = new CouchbaseTargetSystem("user-database")\n    .withCluster(productionCluster)        // Target-specific cluster\n    .withBucket(userBucket)                // Target-specific bucket\n    .addDependency(auditService);          // Custom service for this target\n\n// Global context with different dependencies\nFlamingock.builder()\n    .addDependency(defaultCluster)         // Different cluster in global\n    .addDependency(defaultBucket)          // Different bucket in global\n    .addDependency(emailService)           // Available to all targets\n    .addTargetSystems(couchbaseTarget)\n    .build();\n'})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:'What gets resolved for ChangeUnits in "user-database":'})}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Cluster"}),": Uses ",(0,a.jsx)(t.code,{children:"productionCluster"})," (from target system, not ",(0,a.jsx)(t.code,{children:"defaultCluster"})," from global)"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Bucket"}),": Uses ",(0,a.jsx)(t.code,{children:"userBucket"})," (from target system, not ",(0,a.jsx)(t.code,{children:"defaultBucket"})," from global)"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"AuditService"}),": Available from target system context"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"EmailService"}),": Available from global context"]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"The target system context always takes precedence, ensuring proper isolation between different systems."}),"\n",(0,a.jsx)(t.h2,{id:"transactional-support",children:"Transactional support"}),"\n",(0,a.jsxs)(t.p,{children:["For a ChangeUnit to leverage Couchbase's transactional capabilities, it must use the ",(0,a.jsx)(t.code,{children:"AttemptContext"})," parameter. Flamingock uses the injected ",(0,a.jsx)(t.code,{children:"Cluster"})," and ",(0,a.jsx)(t.code,{children:"Bucket"})," dependencies to create and manage this context's lifecycle - creating the transaction context before execution, committing on success, and rolling back on failure."]}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsxs)(t.p,{children:["For detailed information on transaction handling, see ",(0,a.jsx)(t.a,{href:"/docs/flamingock-library-config/transactions",children:"Transactions"}),"."]}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",children:'@TargetSystem("user-database")\n@ChangeUnit(id = "create-users", order = "001")\npublic class CreateUsers {\n    \n    @Execution\n    public void execution(Cluster cluster, Bucket bucket, AttemptContext txContext) {\n        // AttemptContext is required for transactional execution\n        // Flamingock uses the target system\'s Cluster and Bucket to handle transaction operations\n        // and manages transaction start, commit, and rollback automatically\n        Collection collection = bucket.defaultCollection();\n        \n        JsonObject user = JsonObject.create()\n            .put("name", "John Doe")\n            .put("email", "john@example.com");\n            \n        txContext.insert(collection, "user::001", user);\n    }\n}\n'})}),"\n",(0,a.jsx)(t.p,{children:"You can also work with the Cluster and Bucket directly without transactions:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",children:'@TargetSystem("user-database")\n@ChangeUnit(id = "update-configs", order = "002")\npublic class UpdateConfigs {\n    \n    @Execution\n    public void execution(Cluster cluster, Bucket bucket) {\n        // Operations without AttemptContext won\'t participate in transactions\n        Collection collection = bucket.defaultCollection();\n        \n        JsonObject config = JsonObject.create()\n            .put("version", "2.0")\n            .put("updated", Instant.now().toString());\n            \n        collection.upsert("config::app", config);\n    }\n}\n'})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"How transactions work:"})}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Context creation"}),": Flamingock uses the target system's ",(0,a.jsx)(t.code,{children:"Cluster"})," to create an ",(0,a.jsx)(t.code,{children:"AttemptContext"})," for transaction management"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Transaction management"}),": The same ",(0,a.jsx)(t.code,{children:"Cluster"})," and ",(0,a.jsx)(t.code,{children:"Bucket"})," handle transaction operations and coordinate with the context"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Lifecycle"}),": Flamingock automatically creates the transaction context, commits on success, or rolls back on failure"]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["Without the ",(0,a.jsx)(t.code,{children:"AttemptContext"})," parameter, operations will execute but won't participate in transactions."]}),"\n",(0,a.jsx)(t.h2,{id:"available-dependencies-in-changeunits",children:"Available dependencies in ChangeUnits"}),"\n",(0,a.jsxs)(t.p,{children:["Your ChangeUnits can inject Couchbase-specific dependencies like ",(0,a.jsx)(t.code,{children:"Cluster"}),", ",(0,a.jsx)(t.code,{children:"Bucket"}),", and ",(0,a.jsx)(t.code,{children:"AttemptContext"})," (for transactions), but are not limited to these. Any dependency can be added to the target system context via ",(0,a.jsx)(t.code,{children:".addDependency()"}),", taking precedence over global dependencies."]}),"\n",(0,a.jsxs)(t.p,{children:["For more details on dependency resolution, see ",(0,a.jsx)(t.a,{href:"/docs/flamingock-library-config/context-and-dependencies",children:"Context and dependencies"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["Learn about ",(0,a.jsx)(t.a,{href:"../flamingock-library-config/target-system-configuration.md",children:"Target system configuration"})]}),"\n",(0,a.jsxs)(t.li,{children:["Explore ",(0,a.jsx)(t.a,{href:"/docs/change-units/introduction",children:"ChangeUnits"})]}),"\n",(0,a.jsxs)(t.li,{children:["See ",(0,a.jsx)(t.a,{href:"https://github.com/flamingock/flamingock-examples/tree/master/couchbase",children:"Couchbase examples"})]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var s=n(6540);const a={},c=s.createContext(a);function i(e){const t=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(c.Provider,{value:t},e.children)}}}]);