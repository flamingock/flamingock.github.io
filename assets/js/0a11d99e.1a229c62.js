"use strict";(self.webpackChunkflamingock=self.webpackChunkflamingock||[]).push([[6895],{8072:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"templates/create-your-own-template","title":"Create your template","description":"Templates are available in beta.","source":"@site/docs/templates/create-your-own-template.md","sourceDirName":"templates","slug":"/templates/create-your-own-template","permalink":"/templates/create-your-own-template","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Create your template"},"sidebar":"tutorialSidebar","previous":{"title":"How to use Templates","permalink":"/templates/templates-how-to-use"},"next":{"title":"Introduction","permalink":"/frameworks/springboot-integration/introduction"}}');var a=t(4848),l=t(8453);const o={sidebar_position:3,title:"Create your template"},s="Create your own Flamingock template",r={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Overview of the required components",id:"overview-of-the-required-components",level:2},{value:"1. Implement the Template class",id:"1-implement-the-template-class",level:2},{value:"Important notes",id:"important-notes",level:4},{value:"2. Define Execution and Rollback methods",id:"2-define-execution-and-rollback-methods",level:2},{value:"Example with shared configuration",id:"example-with-shared-configuration",level:3},{value:"Injecting dependencies into Template methods",id:"injecting-dependencies-into-template-methods",level:3},{value:"Mapping between template-base change file and template methods",id:"mapping-between-template-base-change-file-and-template-methods",level:3},{value:"3. Register the Template with ServiceLoader",id:"3-register-the-template-with-serviceloader",level:2},{value:"4. Package and distribute the Template",id:"4-package-and-distribute-the-template",level:2},{value:"Internal Templates (private)",id:"internal-templates-private",level:3},{value:"Public Templates (contributing to the Community)",id:"public-templates-contributing-to-the-community",level:3},{value:"Validation requirements:",id:"validation-requirements",level:4},{value:"\u2705 Best Practices",id:"-best-practices",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"create-your-own-flamingock-template",children:"Create your own Flamingock template"})}),"\n",(0,a.jsxs)(n.admonition,{title:"Beta feature",type:"caution",children:[(0,a.jsxs)(n.p,{children:["Templates are available in ",(0,a.jsx)(n.strong,{children:"beta"}),"."]}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["You can already create ",(0,a.jsx)(n.strong,{children:"custom templates"})," for your own use cases."]}),"\n",(0,a.jsxs)(n.li,{children:["Flamingock is actively developing ",(0,a.jsx)(n.strong,{children:"official templates"})," for key technologies (Kafka, SQL, MongoDB, S3, Redis, etc.) that are currently in development and not yet production-ready."]}),"\n",(0,a.jsx)(n.li,{children:"Expect API and behavior changes before GA."}),"\n"]}),(0,a.jsxs)(n.p,{children:["This feature is a ",(0,a.jsx)(n.strong,{children:"sneak peek of Flamingock's future"}),": a low-code, reusable ecosystem on top of Changes."]})]}),"\n",(0,a.jsx)(n.p,{children:"While official Flamingock templates are experimental, you can already build and use your own custom templates in production if needed. This page explains how."}),"\n",(0,a.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"/templates/templates-introduction",children:"Flamingock Templates"})," allow you to encapsulate common logic and reduce boilerplate when defining change units. This document explains how to create your own templates for reuse across projects or for contribution to the Flamingock community."]}),"\n",(0,a.jsx)(n.h2,{id:"overview-of-the-required-components",children:"Overview of the required components"}),"\n",(0,a.jsx)(n.p,{children:"To create a template, you need:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["A Java class extending ",(0,a.jsx)(n.code,{children:"AbstractChangeTemplate<SHARED_CONFIG, EXECUTION, ROLLBACK>"})]}),"\n",(0,a.jsxs)(n.li,{children:["An ",(0,a.jsx)(n.code,{children:"@Apply"})," method to perform the main change"]}),"\n",(0,a.jsxs)(n.li,{children:["(Optionally) A ",(0,a.jsx)(n.code,{children:"@Rollback"})," method for undo support"]}),"\n",(0,a.jsxs)(n.li,{children:["A service loader registration file (",(0,a.jsx)(n.code,{children:"META-INF/services"}),")"]}),"\n",(0,a.jsx)(n.li,{children:"(Optional) Package and distribute your template"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"1-implement-the-template-class",children:"1. Implement the Template class"}),"\n",(0,a.jsxs)(n.p,{children:["Extend ",(0,a.jsx)(n.code,{children:"AbstractChangeTemplate<SHARED_CONFIG, APPLY, ROLLBACK>"})," with three generics:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"SHARED_CONFIG"}),": Shared configuration that applies to both apply and rollback (e.g., database connection, common settings). Use ",(0,a.jsx)(n.code,{children:"Void"})," if no shared config is needed."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"APPLY"}),": The type representing the apply logic/data"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"ROLLBACK"}),": The type representing the rollback logic/data"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'public class MongoChangeTemplate extends AbstractChangeTemplate<Void, MongoOperation, MongoOperation> {\n\n    public MongoChangeTemplate() {\n        super(MongoOperation.class);\n    }\n\n    @Apply\n    public void apply(MongoDatabase db, @Nullable ClientSession clientSession) {\n        if (this.isTransactional && clientSession == null) {\n            throw new IllegalArgumentException(String.format("Transactional change[%s] requires transactional ecosystem with ClientSession", changeId));\n        }\n        executeOp(db, applyPayload, clientSession);\n    }\n\n    @Rollback\n    public void rollback(MongoDatabase db, @Nullable ClientSession clientSession) {\n        if (this.isTransactional && clientSession == null) {\n            throw new IllegalArgumentException(String.format("Transactional change[%s] requires transactional ecosystem with ClientSession", changeId));\n        }\n        executeOp(db, rollbackPayload, clientSession);\n    }\n\n    private void executeOp(MongoDatabase db, MongoOperation op, ClientSession clientSession) {\n        op.getOperator(db).apply(clientSession);\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"important-notes",children:"Important notes"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Access your apply and rollback data directly via ",(0,a.jsx)(n.code,{children:"this.applyPayload"})," and ",(0,a.jsx)(n.code,{children:"this.rollbackPayload"})," fields."]}),"\n",(0,a.jsxs)(n.li,{children:["Access shared configuration via ",(0,a.jsx)(n.code,{children:"this.configuration"})," field (if using a non-Void shared config type)."]}),"\n",(0,a.jsxs)(n.li,{children:["If your template references custom types, make sure to register them for reflection\u2014especially for ",(0,a.jsx)(n.strong,{children:"GraalVM"})," native builds. When extending ",(0,a.jsx)(n.code,{children:"AbstractChangeTemplate"}),", you can pass your custom types to the superclass constructor to ensure proper reflection support."]}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["See ",(0,a.jsxs)(n.a,{href:"#2-define-execution-and-rollback-methods",children:[(0,a.jsx)(n.strong,{children:"2. Define Execution and Rollback methods"})," "]})," section for how to implement the core logic inside your template class using the apply/rollback data and dependency injection"]})}),"\n",(0,a.jsx)(n.h2,{id:"2-define-execution-and-rollback-methods",children:"2. Define Execution and Rollback methods"}),"\n",(0,a.jsxs)(n.p,{children:["Each template must include an ",(0,a.jsx)(n.code,{children:"@Apply"})," method, and may optionally include a ",(0,a.jsx)(n.code,{children:"@Rollback"})," method.\nThese methods define the core logic that will be executed when Flamingock runs the corresponding change."]}),"\n",(0,a.jsx)(n.p,{children:"Inside these methods, it\u2019s expected that you use the data provided by the user in the template-based change unit through the following fields:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"this.applyPayload"})," \u2014 the apply logic/data to apply during apply phase"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"this.rollbackPayload"})," \u2014 the rollback logic/data to apply during rollback or undo"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"this.configuration"})," \u2014 shared configuration data (if using a non-Void shared config type)"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"An example of a template for Kafka topic management:"}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"This is an illustrative example to demonstrate the template structure. Real Kafka templates would use different parameters and configuration structures based on actual requirements."})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"public class KafkaTopicTemplate extends AbstractChangeTemplate<Void, TopicConfig, String> {\n\n    public KafkaTopicTemplate() {\n        super(TopicConfig.class);\n    }\n\n    @Apply\n    public void apply(AdminClient adminClient) throws Exception {\n        // Create topic using the apply configuration\n        var newTopic = new NewTopic(\n            this.applyPayload.getName(),\n            this.applyPayload.getPartitions(),\n            this.applyPayload.getReplicationFactor()\n        );\n        newTopic.configs(this.applyPayload.getConfigs());\n\n        adminClient.createTopics(List.of(newTopic)).all().get();\n    }\n\n    @Rollback\n    public void rollback(AdminClient adminClient) throws Exception {\n        // Delete topic using the rollback topic name\n        adminClient.deleteTopics(List.of(this.rollbackPayload)).all().get();\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-with-shared-configuration",children:"Example with shared configuration"}),"\n",(0,a.jsx)(n.p,{children:"When you need to share configuration between apply and rollback (such as connection details, common settings, etc.), you can use a non-Void shared configuration type:"}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"This is an illustrative example to demonstrate the shared configuration pattern. Real S3 templates would use different parameters and configuration structures based on actual AWS SDK requirements."})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"public class S3BucketTemplate extends AbstractChangeTemplate<S3ConnectionConfig, BucketCreationRequest, String> {\n\n    public S3BucketTemplate() {\n        super(S3ConnectionConfig.class, BucketCreationRequest.class);\n    }\n\n    @Apply\n    public void apply() {\n        // Access shared configuration for AWS connection\n        AmazonS3 s3Client = AmazonS3ClientBuilder.standard()\n            .withRegion(this.configuration.getRegion())\n            .withCredentials(this.configuration.getCredentialsProvider())\n            .build();\n\n        // Create bucket using apply configuration\n        var request = new CreateBucketRequest(this.applyPayload.getBucketName())\n            .withCannedAcl(this.applyPayload.getAcl());\n\n        if (this.applyPayload.getEncryption() != null) {\n            // Apply encryption settings\n            request.withObjectLockEnabledForBucket(this.applyPayload.getEncryption().isEnabled());\n        }\n\n        s3Client.createBucket(request);\n    }\n\n    @Rollback\n    public void rollback() {\n        // Use the same shared configuration for rollback\n        AmazonS3 s3Client = AmazonS3ClientBuilder.standard()\n            .withRegion(this.configuration.getRegion())\n            .withCredentials(this.configuration.getCredentialsProvider())\n            .build();\n\n        // Delete bucket using rollback bucket name\n        s3Client.deleteBucket(this.rollbackPayload);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"This pattern is useful when:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Both apply and rollback need the same configuration data (AWS credentials, region, etc.)"}),"\n",(0,a.jsx)(n.li,{children:"You want to avoid duplicating connection details or common settings"}),"\n",(0,a.jsx)(n.li,{children:"The template needs different data for apply vs rollback operations"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"injecting-dependencies-into-template-methods",children:"Injecting dependencies into Template methods"}),"\n",(0,a.jsxs)(n.p,{children:["Template methods (such as those annotated with ",(0,a.jsx)(n.code,{children:"@Apply"})," and ",(0,a.jsx)(n.code,{children:"@Rollback"}),") support method-level dependency injection using the same mechanism as change units."]}),"\n",(0,a.jsxs)(n.p,{children:["Template classes do not support constructor injection.\nAll dependencies must be injected as parameters in the ",(0,a.jsx)(n.code,{children:"@Apply"})," and ",(0,a.jsx)(n.code,{children:"@Rollback"})," methods."]}),"\n",(0,a.jsx)(n.p,{children:"You can inject any registered dependency as a method parameter:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"@Apply\npublic void apply(MongoDatabase db, ClientService clientService) {\n  clientService.doSomething();\n}\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Flamingock will apply lock-safety guards unless you annotate the parameter with ",(0,a.jsx)(n.code,{children:"@NonLockGuarded"}),"."]})}),"\n",(0,a.jsx)(n.h3,{id:"mapping-between-template-base-change-file-and-template-methods",children:"Mapping between template-base change file and template methods"}),"\n",(0,a.jsxs)(n.p,{children:["Flamingock automatically maps the ",(0,a.jsx)(n.code,{children:"apply"})," and ",(0,a.jsx)(n.code,{children:"rollback"})," sections in your declarative change unit to the corresponding methods in your template class."]}),"\n",(0,a.jsx)(n.h2,{id:"3-register-the-template-with-serviceloader",children:"3. Register the Template with ServiceLoader"}),"\n",(0,a.jsxs)(n.p,{children:["Templates are discovered automatically at runtime using Java\u2019s ",(0,a.jsx)(n.code,{children:"ServiceLoader"})," system."]}),"\n",(0,a.jsx)(n.p,{children:"Steps:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Create a file at:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"src/main/resources/META-INF/services/io.flamingock.core.api.template.ChangeTemplate\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"List the fully qualified class names of all templates in the file:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plaintext",children:"io.flamingock.template.kafka.CreateTopicTemplate\nio.flamingock.template.kafka.UpdateTopicConfigTemplate\nio.flamingock.template.kafka.DeleteTopicTemplate\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsx)(n.p,{children:"Group templates by domain or technology for better maintainability."})}),"\n",(0,a.jsx)(n.h2,{id:"4-package-and-distribute-the-template",children:"4. Package and distribute the Template"}),"\n",(0,a.jsx)(n.p,{children:"Depending on your target:"}),"\n",(0,a.jsx)(n.h3,{id:"internal-templates-private",children:"Internal Templates (private)"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"No special packaging needed."}),"\n",(0,a.jsx)(n.li,{children:"Keep your template class inside your application."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"public-templates-contributing-to-the-community",children:"Public Templates (contributing to the Community)"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Package your template as a JAR."}),"\n",(0,a.jsxs)(n.li,{children:["Notify the Flamingock team via ",(0,a.jsx)(n.a,{href:"mailto:development@flamingock.io",children:"development@flamingock.io"})," or GitHub."]}),"\n",(0,a.jsx)(n.li,{children:"Submit your template for validation."}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"validation-requirements",children:"Validation requirements:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Clear and justified use case"}),"\n",(0,a.jsx)(n.li,{children:"Name must align and not conflict with existing templates"}),"\n",(0,a.jsx)(n.li,{children:"Technically correct and production-grade implementation"}),"\n",(0,a.jsx)(n.li,{children:"Public classes must be Javadoc-documented"}),"\n",(0,a.jsxs)(n.li,{children:["Submit a Pull Request adding the template's documentation to ",(0,a.jsx)(n.a,{href:"https://github.com/flamingock/flamingock.github.io",children:"flamingock.github.io"})]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-best-practices",children:"\u2705 Best Practices"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Use ",(0,a.jsx)(n.code,{children:"AbstractChangeTemplate<SHARED_CONFIG, EXECUTION, ROLLBACK>"})," with the appropriate generic types for your use case."]}),"\n",(0,a.jsxs)(n.li,{children:["Always provide an ",(0,a.jsx)(n.code,{children:"@Rollback"})," method if rollback or undo is expected."]}),"\n",(0,a.jsxs)(n.li,{children:["Use ",(0,a.jsx)(n.code,{children:"Void"})," for generics when that type is not needed (e.g., ",(0,a.jsx)(n.code,{children:"<Void, String, String>"})," for simple SQL templates)."]}),"\n",(0,a.jsxs)(n.li,{children:["Use shared configuration (",(0,a.jsx)(n.code,{children:"<ConfigType, Void, Void>"}),") when both apply and rollback need the same configuration data."]}),"\n",(0,a.jsx)(n.li,{children:"Document your template's purpose and generic types clearly for users."}),"\n",(0,a.jsx)(n.li,{children:"Ensure all custom types are registered for reflection by passing them to the superclass constructor, especially when targeting native builds."}),"\n",(0,a.jsx)(n.li,{children:"Group multiple templates by domain when packaging a library."}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var i=t(6540);const a={},l=i.createContext(a);function o(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);